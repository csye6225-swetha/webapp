name: Packer Check

on:
  pull_request:
    branches:
      - main
     
    paths:
      - 'packer/**'    # Include all HCL files

jobs:
  packer-check:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      
    - name: Packer init
      run: | 
       cd packer 
       packer init . 

    - name: Packer Format Check
      run: |
        for template in $(find . -name '*.json' -o -name '*.hcl'); do
          packer fmt "$template"
        done
      

    - name: Packer Validate
      run: |
        for template in $(find . -name '*.json' -o -name '*.hcl'); do
          packer validate "$template"
        done
      
